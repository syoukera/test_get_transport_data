# test_get_transport_data
chemkin純正コードのcklib.fとtplib.fを用いて，拡散係数と熱伝導率，定圧比熱を返すプログラムです．

## レポジトリの概要
このコード群は二つの機能に分かれています．1のステップについて，GRIの出力ファイルをlinkフォルダに既に配置しているので，GRI-mechを用いる場合には不要です．ですので，CFD計算に使用する際には，使い方における**2. 輸送係数の取得と時間進行計算**の手順のみで大丈夫です．
1. 反応機構と熱力学データおよび輸送データからcklinkとtplinkへの変換
2. cklinkとtplinkを用いてCFDの任意の条件から輸送係数の取得と時間進行計算

## ディレクト構成
```
test_get_CFD_values/
├── README.md

 #　---------- 1. cklinkとtplinkへの変換 ----------
 ## 反応機構，熱力学データ，輸送係数データ
├── data
│   ├── mech
│   ├── thermdat
│   └── trandat

 ## ソースコードとシェルスクリプト
├── interp.sh
├── ckinterp
│   ├── ckinterp.f
│   ├── ckinterpe
│   └── compl.sh
├── tranfit
│   ├── cklib.f
│   ├── compl.sh
│   ├── dmath.f
│   ├── tranfit.f
│   └── tranfite

 ## 実行結果のテキストファイル
├── output
│   ├── ckout
│   └── tpout

 ## 1の出力ファイル（2の入力ファイル）
├── link
│   ├── cklink
│   └── tplink

 # 2. ---------- 輸送係数の取得と時間進行計算 ----------
 ## シェルスクリプト
├── compile.sh
├── clean.sh

 ## ソースコード
├── src
│   ├── chemkin_m.f90
│   ├── cklib.f
│   ├── dasac.f
│   ├── dmath.f
│   ├── main.f90
│   ├── output_m.f90
│   ├── senkin.f
│   ├── tranlib.f
│   └── twopnt.f

 ## 実行ファイル
└── get_CFD_values
```

## 使い方

### 動作確認した環境
- Ubuntu 18.04 LTS
- gfortranが使用できること

### 1. cklinkとtplinkへの変換
必要なファイルは以下，現状ではGRI-mechを置いています．
- data/mech
- data/thermdat
- data/trandat

手順は以下の通りです．
1. 上に記述したような形で，反応機構をmechに，熱力学データをthermdatに，輸送係数データをtrndatとして保存する
2. 以下のように変換のスクリプトを実行
```bash
bash interp.sh
```
3. linkフォルダ以下にcklinkとtplink（バイナリファイル）が出力されることを確認
4. outputフォルダckoutとtpout（テキストファイル）が出力されているので，詳しく知りたい際にはそちらを参照

### 2. 輸送係数の取得と時間進行計算
サンプルプログラム `main.f90` を実行する場合．linkフォルダ以下にcklinkとtplinkがある状態

1. コンパイルを実行
```bash
bash compile.sh > log.compile 2>&1
```
2. コードの実行
```bash
./get_CFD_values
```
3. 標準出力に輸送係数に関するデータ（化学種ごとの拡散係数，熱伝導率，定圧比熱）とΔt秒後の温度および化学種の質量分率が出力される．
```
 mixture diffusion coefficient [CM**2/S]
  0.15386094061814490       0.26056454801743739        6.4003052932046056E-002   3.7892539287739016E-002   6.2714327504056588E-002   5.2979335779062102E-002   4.0868658273109364E-002   4.0579521211909324E-002   6.0319273354934595E-002   6.8769149472036842E-002   4.6602782474625896E-002   4.6602782474625896E-002   4.5502526892018808E-002   4.5293271570821719E-002   4.0636386233038509E-002   3.2743963560225534E-002   3.5061216766813716E-002   3.4760244182783263E-002   3.4131951550811598E-002   3.4131951550811598E-002   3.3990615876633927E-002   3.4687306939093741E-002   3.4317451040528683E-002   3.3972199748462363E-002   3.3844825590156301E-002   3.1092209612408963E-002   3.0827419994042839E-002   5.0799388133682899E-002   2.9455495805087679E-002   2.9455495805087679E-002   5.7086926179789999E-002   6.7569685107885469E-002   6.6090308654989785E-002   4.9969175170067791E-002   3.9682974571595683E-002   4.0272047641567874E-002   3.5588241209947989E-002   3.2321310344016342E-002   4.0800296698631236E-002   4.0038161253324628E-002   3.4782020208300873E-002   3.4450268366121861E-002   5.0798642089273607E-002   3.2468120664585987E-002   3.2468120664585987E-002   3.2468120664585987E-002   3.2624542479208644E-002   4.3290261285444491E-002   3.9793591261326179E-002   2.3974946776584825E-002   2.3866154697290344E-002   2.9314193659257280E-002   2.9178860647594874E-002
 mixture thermal conductivity [ERG/CM*K*S]
   7142.0897398181532     
 mean specific heat at constant pressure [ergs/(gm*K)]
   165528499417.68396     
 temperature [K]
   2700.6469543844664     
 mole fractions [-]
   3.8508965403496190E-004   2.4037412642250932E-005   2.6668330990758921E-004   7.4124284737227125E-003   3.5656795099237104E-003  0.11831168336152144        6.8392328730318508E-006   1.1886708382391564E-006   6.4391042248776643E-015   2.4019615014988446E-015   6.9341825107425198E-015   5.9559274726349751E-016   3.2666201442773771E-014   1.6399685511956845E-014   1.5744899022832881E-002  0.12655052949081066 　　4.6359711079620141E-008   1.4316263190405000E-009   8.6389994815581795E-014   1.8522567915425931E-015   8.9977041785596373E-015   1.0462509571063945E-019   8.2126860441942113E-018   8.9693294575128144E-022   6.9553131148942854E-022   1.0137610939323923E-025   7.6523043989401161E-027   4.4974864212347423E-016   5.1956364928212212E-016   1.8820751744621421E-018   1.1172083262927543E-007   4.6459075304621913E-008   3.0143884509846983E-008   7.0186852874111701E-008   6.4688429368532320E-008   5.7616276966328643E-003   7.1376156036438408E-006   2.8366654653904168E-006   9.5611325991040707E-007   1.8010043209221930E-011   2.2435326372842025E-009   1.4722487983925286E-014   3.5324335004295455E-017   2.0830633630110700E-013   3.8219648394404981E-010   5.0354716319581447E-008   2.8567754079321739E-009  0.72195795692389941        0.0000000000000000        9.0735320440188270E-038   6.7211581713368745E-039   3.1904160244089369E-020   1.0269762386579244E-021
```
4. 

### 備考
- 拡散係数の算出には，平均化された(Averaged)ものを使用している．より厳密な他成分系の拡散係数も算出可能だが，今回は使用していない．
- 定圧比熱はtplibではなく，cklibから計算できるが，ついでなので一緒に出力するようにした．
- 結果をCHEMKIN-PROの出力と確認したものをcheck_result.xlsxに配置している
- エネルギーの単位がErgになっていますので，必要に応じて単位換算をお願いいたします．
- initialize_chemkin_workarrayの呼び出しは，すべての時刻，全てのセルにわたって一回だけとなるようにしてください．ファイルのOPENとメモリの割り当てでエラーが出る可能性が高いです．
